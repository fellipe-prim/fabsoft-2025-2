<div class="container py-5 text-center">
    <!-- Cabeçalho -->
    <h2 class="mb-4">Selecione seus Assentos</h2>
    
    <p class="text-muted" *ngIf="sessao">
        Filme: <strong>{{ sessao.filme.titulo }}</strong> | 
        Horário: 
        <!-- Lógica para exibir hora vindo de Array do Java -->
        <span *ngIf="sessao.dataHora.length">
            {{ sessao.dataHora[3] | number:'2.0' }}:{{ sessao.dataHora[4] | number:'2.0' }}
        </span>
    </p>

    <div class="screen-container mb-5">
        <div class="screen">TELA</div>
    </div>

    <!-- GRID DE CADEIRAS REAIS -->
    <div class="assentos-grid">
        <div *ngFor="let ingresso of listaIngressos" 
             (click)="toggleAssento(ingresso)"
             class="assento"
             [class.selecionado]="selecionados.has(ingresso)"
             [class.ocupado]="ingresso.status === 'VENDIDO'"> 
             <!-- .ocupado fica vermelho se status for VENDIDO -->
             
             <i class="bi bi-person-fill"></i>
             <span class="small d-block mt-1">{{ ingresso.numeroAssento }}</span>
        </div>
    </div>

    <!-- LEGENDA -->
    <div class="d-flex justify-content-center gap-4 mt-4 small">
        <div class="d-flex align-items-center"><div class="legenda livre"></div> Livre</div>
        <div class="d-flex align-items-center"><div class="legenda selecionado"></div> Selecionado</div>
        <div class="d-flex align-items-center"><div class="legenda ocupado"></div> Ocupado</div>
    </div>

    <!-- ÁREA DE RESUMO DE PAGAMENTO (NOVO) -->
    <div class="card mt-5 mx-auto shadow-sm border-0" style="max-width: 500px; background-color: #fff;">
        <div class="card-body text-start">
            <h5 class="fw-bold border-bottom pb-2 mb-3">Resumo do Pedido</h5>
            
            <div class="d-flex justify-content-between mb-2">
                <span>Ingressos selecionados:</span>
                <span class="fw-bold">{{ selecionados.size }}</span>
            </div>
            
            <div class="d-flex justify-content-between mb-2">
                <span>Preço unitário:</span>
                <!-- Pega o valor do primeiro ingresso da lista (todos têm o mesmo preço na sessão) -->
                <span>R$ {{ (listaIngressos[0]?.valorPago || 0) | number:'1.2-2' }}</span>
            </div>

            <div class="d-flex justify-content-between align-items-center mt-4 pt-2 border-top">
                <span class="fs-5">Total a pagar:</span>
                <span class="fs-2 fw-bold text-success">
                    R$ {{ total | number:'1.2-2' }}
                </span>
            </div>

            <!-- Botão de Pagamento com Estado de Carregando -->
            <button (click)="finalizarCompra()" 
                    class="btn btn-success w-100 mt-4 py-3 fw-bold fs-5"
                    [disabled]="processandoPagamento || selecionados.size === 0">
                
                <!-- Estado Normal -->
                <span *ngIf="!processandoPagamento">
                    <i class="bi bi-credit-card-2-front me-2"></i> Pagar Agora
                </span>
                
                <!-- Estado Processando -->
                <span *ngIf="processandoPagamento">
                    <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                    Processando...
                </span>
            </button>

        </div>
    </div>

</div>